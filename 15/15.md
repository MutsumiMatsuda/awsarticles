# (15)VPCの構築

## 本章の目的：

- VPCやサブネットとは何かを学ぶ。
- VPCとインターネットとの接続方法を学ぶ。

***

ネットワークは規模によっては多数のPCやサーバで構成されます。全てを同じレイヤーのネットワークにまとめると、一括管理をするのが難しくなるし、障害発生時の影響も大きくなります。

よって通常ネットワークは複数の単位に分割されます。それらを**サブネット**といいます。サブネットを上手に活用し、部署やフロアごとにサブネットを分けたり、インターネットから接続できるサブネットとできないできないサブネットに分けてセキュリティを担保する、といったことができます。。

本章では、サブネットとは何か、また複数のサブネットを包括する**VPC(Virtual Private Cloud)やサブネット**とは何か、AWS内でどうやってそれらを実装するのかを学びます。

### 1. 今回構築するVPCの構成

まずはじめに、今回構築するVPCの全容をご確認ください。

＜図１：VPCの全体像＞

この全体像をもとに、VPCやサブネットとは何かを解説します。以降の解説は、この全体像と見比べながら読んでください。

#### 1-1. サブネット

**サブネット**とは、分割したネットワークの1つ1つをいいます。サブネットの単位です。ちょっと先ほどの繰り返しになりますが、どのようなシーンでサブネットを活用するのかを考えてみましょう。

個人宅のような小さなネットワークではサブネットを考える必要はありません。よほどマニアックな方でない限り、自宅のネットワークをサブネットで構成していることはあり得ません。

企業では普通は部署が複数集まって構成されています。その部署ごとにPCの台数も異なるしセキュリティポリシーも違います。よって全てを一つのネットワークにまとめるのは無理があるのです。そこでサブネットを作ってネットワークを分割する必要があります。

そうはいっても今回の構成はサブネット1つ、EC2が1つという超簡単な構成なのでありがたみが感じられません。それもその通りで、応用編まで進んでようやくサブネットのありがたみを感じることができます。今のところはとりあえず「複数のネットワークに分ける」「サブネットってこんなもの」このレベルで理解すれば十分です。

サブネットはPCやサーバと同じく、IPアドレスを持ちます。これを**ネットワークアドレス**といいます。

#### 1-2. VPC

VPCは、仮想ネットワークを構築するAWSのサービスです。こういってしまえばそれまでですが、ここではとりあえず「今回構築するネットワーク全体」と理解してください。最初にVPCを作り、その中に要件に従ったサブネットを順次構築していきます。

今回はVPCとインターネットの間に**インターネットゲートウェイ**を置いて接続するので、VPCの外側はインターネット、ということになります。

またVPCはAWSアカウント間で独立しています。

#### 1-3. CIDR(サイダー)

先ほど1-1にて、サブネットごとにアドレスを持つと解説しました。ではサーバは所属しているネットワークアドレスと自身のIPアドレスを別個に管理するのでしょうか？実はそうではありません。

IPアドレスとは「32ビットの2進数を8ビットづつに分けて、それぞれを10進数に変換したもの」というのを12章で説明しました。**サーバやPCのIPアドレスのうち左から任意のビット数をネットワークアドレスとする**、と定義できるのです。

＜図２：CIDR表記の説明＞

今回は、さほどネットワークの規模が大きくないので、```10.0.0.0/24```とし、左から24ビット目までをネットワークアドレスとしています。この表記方法を **CIDR(サイダー)** といいます。

#### 1-4. インターネットゲートウェイ

VPCとインターネットとは直接繋がっていますが、インターネットとサーバインスタンスは直接繋がっていません。接続点にインターネットゲートウェイを設置し、それを内外をつなぐ関所とします。

インターネットから直接サーバインスタンスへ繋がるようでは、セキュリティ設定等々を全てインスタンス側で設定しなくてはいけないどころか、複数のインスタンスを立てるとなると全てに同じ設定をしなくてはなりません。

インターネットゲートウェイが、VPC配下を守ってくれているようなイメージです。

### 2. VPCやサブネットの実装

ではこれより、実際にVPCやサブネットを実装していきましょう。もうここからはルートアカウントで作業せず、IAMで作った神アカウント「Administrator」でログインしてください。

コンソールよりVPCのサービスを開いてください。ここで再度、東京リージョンが選択されていることを確認しておきましょう。上図の赤枠の部分です。

＜図３：VPCサービスを開く＞

「VPCを作成する」ボタンをクリックしてください。

＜図４：ステップ１ VPC設定の選択＞

「選択する」ボタンをクリックしてください。

＜図５：ステップ２ 1個のパブリックサブネットを持つVPC＞

VPC名とサブネット名はわかりやすい名前なら結構ですが、もしうまくいかない時に質問を投稿することを考えて、できるだけ同じ内容を入力してください。入力し終えたら「VPCの作成」ボタンをクリックしてください。

＜図６：VPC作成完了＞

ほんの数秒後にはできました。左側のメニューに沿って順番に確認していきましょう。メニューの「VPC」をクリックしてください。

＜図７：VPC＞

できてますね。あと同様に、サブネットやインターネットゲートウェイも先にあげた全体像と見比べて確認しておいてください。

### まとめ

意外なほどに簡単にVPCとサブネットができたこと、体感していただけたでしょうか？次はいよいよVPC内にEC2インスタンスを立ち上げて、そこへ接続するまでを解説します。

