# (15)VPCの構築

## 本章の目的：

- インターネットゲートウェイとは何かを学習する。
- AWSにてVPCやサブネットを構築する。

***

通常、ネットワークに参加する人やPCが多くなると、ネットワークを複数の単位に分割します。理由は、多数のサーバやPCを１つのネットワークにまとめてしまうと、一括管理をするのが難しくなってしまうからです。また、仕様変更に柔軟に対応するのも難しくなります。さらに、ネットワークの規模が大きくなると、比例して障害発生時の影響も大きくなリます。たった１台のPCのトラブルが、全体に及ぶこともあるのです。

上記の理由により複数のネットワークに分けて更生するのが一般的です。そして複数に分けたネットワーク1つ1つを**サブネット**といいます。サブネットを上手に活用し、部署やフロアごとにサブネットを分けたり、インターネットから接続できるサブネットとできないできないサブネットに分けてセキュリティを担保する、といったことができます。

このような内容は、12章で解説しました。不安のある方は12章をもう一度目を通しておくことをオススメします。

本章では、実際に **AWS VPC(Virtual Private Cloud)を構築し、その中にサブネットを立ち上げます。** またインターネットゲートウェイトサブネットを接続し、インターネット側からアクセスできるようにします。

### 1. 今回構築するVPCの構成

まずはじめに、今回構築するVPCの全容をご確認ください。

![図15-1. VPCの全体像](15-1.svg)

この全体像をもとに、VPCやサブネットの構築方法を解説します。以降は、この全体像を見ながら読んでください。

#### 1-1. VPC

 **AWS VPCは、仮想ネットワークを構築するAWSのサービスです。**
こういってしまえばそれまでですが、ここではとりあえず「今回構築するネットワーク全体」と理解してください。最初にVPCを作り、その中に要件に従ったサブネットを順次立ち上げていきます。

VPC内にインターネット回線を引き込むために**インターネットゲートウェイ**を置きます。このインターネットゲートウェイにサブネットを接続（アタッチ）すると、インターネットとサブネット内のサーバインスタンスが繋がります。ちょっとややこしいので、全体像を見ながら以下の流れを理解してください。

インターネット →   
&nbsp;&nbsp;&nbsp;&nbsp;インターネットゲートウェイ →   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;サブネット →  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
サブネット内のサーバインスタンス

#### 1-2. インターネットゲートウェイ

インターネットとサブネットやサーバインスタンスは直接繋がっていません。よってVPCに通気孔を開けるようなイメージで、VPC内外の接続点にインターネットゲートウェイを設置します。

インターネットゲートウェイ自体、ある程度の通信の牽制をかけることが可能です。いわゆるVPC内外の関所となります。ここがとても重要です。仮にインターネットから直接個々のサーバインスタンスへ繋がるなら、どのような問題が起こるでしょうか？複数のインスタンスを立ち上げた場合、セキュリティ設定等々を全てインスタンスごとに設定しなくてはいけません。

インターネットゲートウェイには、VPC内外の接続ポイントとしての役割、セキュリティ的関所としての役割の２つあることを覚えておきましょう。

### 2. VPCやサブネットの実装

ではこれより、実際にVPCやサブネットを実装していきましょう。もうここからはルートアカウントで作業せず、IAMで作った神アカウント「Administrator」でログインしてください。

コンソールよりVPCのサービスを開いてください。ここで再度、東京リージョンが選択されていることを確認しておきましょう。

![図15-1-1. VPCサービスを開く](15-1-1.png)

「VPCの作成」ボタンをクリックしてください。

![図15-4-1. ステップ１ VPC設定の選択](15-4-1.png)

「選択する」ボタンをクリックしてください。

![図15-5-1. ステップ２ 1個のパブリックサブネットを持つVPC](15-5-1.png)

VPC名とサブネット名はわかりやすい名前なら結構ですが、もしうまくいかない時に質問を投稿することを考えて、できるだけ同じ内容を入力してください。入力し終えたら「VPCの作成」ボタンをクリックしてください。

![図15-6-1. VPC作成完了](15-6-1.png)

ほんの数秒後にはできました。左側のメニューに沿って順番に確認していきましょう。メニューの「VPC」をクリックしてください。

![図15-7-1. VPC](15-7-1.png)

できてますね。あと同様に、サブネットやインターネットゲートウェイも先にあげた全体像と見比べて確認しておいてください。

### まとめ

意外なほどに簡単にVPCとサブネットができたこと、体感していただけたでしょうか？次はいよいよVPC内にEC2インスタンスを立ち上げて、そこへ接続するまでを解説します。

