# (14)IAMを使ったアクセス管理 

## 本章の目的：

- セキュリティポリシーを設計する。
- IAMを使ったセキュリティポリシーを実装する。

***

誰が何をできるかを設定することをセキュリティポリシーと呼ぶ、ということはすでに解説しました。今回はより深くセキュリティポリシーを考えて、それをAWSのサービスであるAWS IAMにより実装しましょう。

本コースの開発時にも、IAMによるセキュリティ管理体系を策定しました。記事執筆ならびにコース責任者のアカウントは「administrator」、それ以外は個人ごとのアカウントを作成しました。

### 1. セキュリティ設計

このコースを受講の方は、コースの教材通りに学習してきたとすれば、AWSにユーザ登録した時に使ったアカウント、つまりメールアドレスでログインしているはずです。これはルートユーザという神アカウントであり、AWSでできることイコールあなたができること、なのです。しかし、誰かにルートユーザを奪われた時は最悪です。何でもできるアカウントなので、奪った人はもはや何でもありになってしまいます。

よってAWS的には、IAMで管理ユーザを作成して使用し、ルートユーザのアクセスキーをロックすることを推奨しています。本コースでもそれにならい、IAMで管理ユーザを作ります。ただしルートユーザのロックは、本コースでは扱いません。みなさんがWebサイトを一般公開する時に実施してください。その頃にはAWSにすっかり慣れて、自分で調べて対応できるようになっているはずです。

ここでもう一度、今回のセキュリティ方針を定義しておきましょう。

・管理者

ルートユーザに匹敵する、最強神ユーザです。ほぼ何でもできます。ただし基本的にはこのアカウントを使うのはあなた一人とします。

・一般ユーザ

将来的にあなたのサイトの規模が大きくなり、外部から来た人に操作してもらうことを想定しています。当初は一人管理者兼一般ユーザ状態だとしても、ゆくゆくは誰かの手を借りる対応を考えなくてはいけません。そんなユーザを使う・使わないはさておいて、今の段階で作っておきましょう。

また、インスタンス丸ごと削除といった、管理者であるあなたですら滅多にやらないことはできなくしてしまいます。よってあなたが操作するときも一般ユーザでログインして、誤まって重大な操作をしてしまわないように、という牽制の意味もあります。

上記2つはグループという単位で定義します。よって、新たに参画する時は、アカウント登録してそれに対してグループを付与する、という流れです。一人一人にできることすべてを付与する必要はないということに注意してください。

・ロール

上記２つは人に付与するものですが、人以外に付与する場合は、ユーザではなくロールを付与します。ここで、パラダイムシフトが必要になります。

ユーザは生身の人間１人格あたりに付与するものですので、理解するのも簡単です。ではサーバは？サーバがサーバにログインする、つまりサーバAがサーバBにログインする場合、BにはAのためのアカウントが必要です。アカウントは人間のためだけではないのです。

では、ユーザをはじめとしてAWSのリソースをアカウント登録するのかというとそうではなく、人ではないリソースには、ロールというものを付与します。

ここでまとめましょう。

＜図：セキュリティポリシー＞

AWS AMIは、本コースの教材を開発するときに使用しています。メインとなる執筆者を管理ユーザとして設定し、それ以外のメンバーは個々にユーザを作成しています。

少し遠目に見てみると「複数人で共同作業するからといって、使う人全員がクレジットカードを持っていて、かつAWSのアカウント登録をする必要はない」ということが分かりますね。

### 2. IAMの実装

AWSの全サービスや各種リソースに対してフル権限をもつユーザを「Administrator」として作成します。これはもちろん、あ・な・たです。

それ以外の一般ユーザは「users」というグループを定義し、それを一般ユーザに割り当てます。usersはサーバインスタンスの起動と停止だけを許可しましょう。このように、一般的に権限設定とは必要最低限の権限だけを付与して、足りないことがあれば順次追加していくのが王道です。

最初からあれやこれやと想定して、使わない権限を多数設定するということがないようにしましょうね！

#### 2-1.IAMでグループ作成

管理者グループ「Administrator」を作成します。AWSマネジメントコンソールからIAMを選択してください。

＜図：1＞

左のメニューから「グループ」をクリックしてください。

＜図：2＞

グループ名を入力しましょう。「Administrator」と入力してください。

＜図：3＞

入力後、一番右下あたりにある「次のステップ」ボタンをクリックしてください。そして表示された画面で、ポリシーの一覧表示の上あたりの「フィルター」をクリックして「AWS管理ポリシー」に変更してください。

＜図：4＞

そして以下にチェックを入れてください。

AdministratorAccess

今のところ管理ユーザですらEC2とVPCしか使いませんが、とりあえずルートユーザに変わるものを設定しておきましょう。チェックを入れたら「次のステップ」ボタンをクリックしてください。

＜図：5＞

「グループの作成」ボタンをクリックしてください。

＜図：6＞

できました。同じ要領でもう一つグループを作ってみてください。名前は「Users」、設定するポリシーはAmazonEC2ReadOnlyAccessとAmazonVPCReadOnlyAccessの2つです。

＜図：7＞

できました。次はユーザを作り、そのユーザをグループに参加させましょう。

#### 2-2.IAMでユーザ作成

管理者「Administrator」を作ります。今度は左側のメニューから「ユーザー」をクリックしてください。

＜図：８＞

「ユーザーを追加」ボタンをクリックしてください。

＜図：9-1 / 9-2＞

基本的に画像通りに入力してください。「アクセスの種類」は、当面コンソールからのログインしか想定していないので「プログラムによるアクセス」のチェックは外してください。

入力が終わったら「次のステップ：アクセス権限」ボタンをクリックしてください。

＜図：10＞

もちろん「Administrator」にチェックを入れます。そして「次のステップ：タグ」ボタンをクリックします。

＜図：11＞

タグはあとで考えるとして、ここでは何もせず「次のステップ：確認」ボタンをクリックしてください。

＜図：12＞

内容を確認して、問題がなければ「ユーザの作成」ボタンをクリックします。

＜図：13＞

できました。この画面で「.csvのダウンロード」をクリックして認証情報をダウンロードしておくことと、念のため「Eメールの送信」をクリックして、自分宛に案内メールを送っておきましょう。内容は以下のようなものです。

```
AWS をご利用いただきありがとうございます。

5673 に終了する ID のアマゾン ウェブ サービスのアカウントに対して、AWS マネジメントコンソールへのアクセス権が付与されました。以下のサインイン情報を使用してご利用を開始していただけます。

-------------------------------------------------

サインイン URL: https://699305205673.signin.aws.amazon.com/console
ユーザー名: Administrator

最初のサインインパスワードは、AWS アカウント管理者から、この E メールとは別にお知らせいたします。最初にサインインするときに、パスワードを変更する必要があります。

-------------------------------------------------

プロファイルを作成して AWS とのつながりを維持してください: https://pages.awscloud.com/IAM-communication-preferences.html

今後ともよろしくお願いいたします。
AWS アカウント管理者
```

メール送信まで終われば「閉じる」ボタンで閉じて結構です。

次回以降、上記で示されている「サインイン URL」から、アカウントは「Administrator」で、かつ上記手順で設定したパスワードでログインしてください。

一度サインアウトしましょう。「AWSにようこそ」をクリックすると、出てきたメニューの中に「サインアウト」があります。

＜図14＞

サインアウトして、上記で振られたURLでログインしてください。

＜図15＞

ログインすると、初回だけパスワードの再設定画面が出てきますが、それ以降は今までと同じように使えます。

### 2-3. 課題

同じ要領で、users権限をもつユーザを作ってみてください。

名前は何でも構いません。そしてusersグループへ参加させてあげてください。そしてログインまで確認できると完了です。

### まとめ

本章では、IAMを使ったグループやユーザ作成を解説しました。今後作業する際は、ぜひ今回作ったAdministrator権限で操作してください。

